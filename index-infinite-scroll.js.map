{"version":3,"file":"index-infinite-scroll.js","sources":["../src/js/infinite-scroll.js"],"sourcesContent":["\"use strict\"\n\nimport iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nimport toastErrorIcon from \"../img/toast-error.svg\";\nimport toastInfoIcon from \"../img/toast-info-bell.svg\";\n\n// to use a different image source, just create new functions getPictures and createGallery and change these two imports\nimport { getPictures } from \"./get-pixabay-pictures\"; \nimport { createGallery } from \"./create-pixabay-gallery\";\n\nconst form = document.querySelector(\".image-search-form\");\nconst gallery = document.querySelector(\".gallery\");\nconst loader = document.querySelector(\".loader-container\");\nconst modalLightbox = new SimpleLightbox(\".gallery-item-link\", {\n    captions: true,\n    captionsData: \"alt\",\n    captionDelay: 250,  \n});\n\nconst options = {\n    root: null,\n    rootMargin: \"0px\",\n    threshold: 0.1,\n};\nconst loadMoreImagesObserverTarget = document.querySelector(\".infinite-scroll\");\nconst loadMoreImagesObserver = new IntersectionObserver(loadMoreImages, options);\n\nconst endSearchResultObserverTarget = document.querySelector(\".back-link\");\nconst endSearchResultObserver = new IntersectionObserver((entries, observer) => {\n    entries.forEach((entry) => {\n        if (entry.isIntersecting) {\n            loader.classList.add(\"hidden\");\n            const toast = document.querySelector('.iziToast');\n            if (!toast) {\n                iziToast.show({\n                    iconUrl: toastInfoIcon,\n                    message: \"We're sorry, but you've reached<br>the end of search results.\",\n                    position: \"topRight\",\n                    backgroundColor: \"#0099FF\",\n                    messageColor: \"white\",\n                    progressBarColor: \"#0071BD\",\n                    theme: \"dark\",\n                });\n            }\n            observer.unobserve(entry.target);\n        }\n    });\n}, options);\n\nlet searchTerm = null;\nlet page = 1;\nlet imagesPerPage = 40;\n\nfunction noMatchingResults() {\n    iziToast.show({\n        iconUrl: toastErrorIcon,\n        message: \"Sorry, there are no images matching<br>your search query. Please try again!\",\n        position: \"topRight\",\n        backgroundColor: \"#EF4040\",\n        messageColor: \"white\",\n        progressBarColor: \"#B51B1B\",\n        theme: \"dark\",\n    });\n    loader.classList.add(\"hidden\");\n}\n\nasync function loadImages() {\n    try {\n        const response = await getPictures(searchTerm, page, imagesPerPage);\n        if (response.totalHits === 0) {\n            noMatchingResults();\n        } else {\n            gallery.appendChild(createGallery(response.hits));\n            if (response.totalHits > imagesPerPage * page) {\n                loadMoreImagesObserver.observe(loadMoreImagesObserverTarget);  \n            } else {\n                loadMoreImagesObserver.unobserve(loadMoreImagesObserverTarget);\n                endSearchResultObserver.observe(endSearchResultObserverTarget);\n                endSearchResultObserverTarget.classList.remove(\"hidden\");\n            }\n            modalLightbox.refresh();\n            gallery.classList.remove(\"hidden\");\n            loader.classList.add(\"hidden\");\n            \n        }\n    } catch (error) {\n        console.log(\"Error:\", error)\n    }\n}\n\nfunction prepareElements() {\n    loader.classList.remove(\"hidden\");\n    gallery.classList.add(\"hidden\");\n    endSearchResultObserverTarget.classList.add(\"hidden\");\n    page = 1;\n    gallery.innerHTML = \"\";\n    const toast = document.querySelector('.iziToast');\n    if (toast) {\n        iziToast.hide({\n            transitionOut: 'fadeOutUp'\n        }, toast);\n    }\n}\n\nasync function loadMoreImages() {\n    loader.classList.remove(\"hidden\");\n    page++;\n    await loadImages();\n}\n\nform.addEventListener(\"submit\", async (evt) => {\n    evt.preventDefault();\n    prepareElements();\n    searchTerm = form.elements.searchTerm.value.trim();\n    await loadImages();\n    form.reset(); \n});\n\n"],"names":["form","gallery","loader","modalLightbox","SimpleLightbox","options","loadMoreImagesObserverTarget","loadMoreImagesObserver","loadMoreImages","endSearchResultObserverTarget","endSearchResultObserver","entries","observer","entry","iziToast","toastInfoIcon","searchTerm","page","imagesPerPage","noMatchingResults","toastErrorIcon","loadImages","response","getPictures","createGallery","error","prepareElements","toast","evt"],"mappings":"0HAcA,MAAMA,EAAO,SAAS,cAAc,oBAAoB,EAClDC,EAAU,SAAS,cAAc,UAAU,EAC3CC,EAAS,SAAS,cAAc,mBAAmB,EACnDC,EAAgB,IAAIC,EAAe,qBAAsB,CAC3D,SAAU,GACV,aAAc,MACd,aAAc,GAClB,CAAC,EAEKC,EAAU,CACZ,KAAM,KACN,WAAY,MACZ,UAAW,EACf,EACMC,EAA+B,SAAS,cAAc,kBAAkB,EACxEC,EAAyB,IAAI,qBAAqBC,EAAgBH,CAAO,EAEzEI,EAAgC,SAAS,cAAc,YAAY,EACnEC,EAA0B,IAAI,qBAAqB,CAACC,EAASC,IAAa,CAC5ED,EAAQ,QAASE,GAAU,CACnBA,EAAM,iBACNX,EAAO,UAAU,IAAI,QAAQ,EACf,SAAS,cAAc,WAAW,GAE5CY,EAAS,KAAK,CACV,QAASC,EACT,QAAS,gEACT,SAAU,WACV,gBAAiB,UACjB,aAAc,QACd,iBAAkB,UAClB,MAAO,MAC3B,CAAiB,EAELH,EAAS,UAAUC,EAAM,MAAM,EAE3C,CAAK,CACL,EAAGR,CAAO,EAEV,IAAIW,EAAa,KACbC,EAAO,EACPC,EAAgB,GAEpB,SAASC,GAAoB,CACzBL,EAAS,KAAK,CACV,QAASM,EACT,QAAS,8EACT,SAAU,WACV,gBAAiB,UACjB,aAAc,QACd,iBAAkB,UAClB,MAAO,MACf,CAAK,EACDlB,EAAO,UAAU,IAAI,QAAQ,CACjC,CAEA,eAAemB,GAAa,CACxB,GAAI,CACA,MAAMC,EAAW,MAAMC,EAAYP,EAAYC,EAAMC,CAAa,EAC9DI,EAAS,YAAc,EACvBH,KAEAlB,EAAQ,YAAYuB,EAAcF,EAAS,IAAI,CAAC,EAC5CA,EAAS,UAAYJ,EAAgBD,EACrCV,EAAuB,QAAQD,CAA4B,GAE3DC,EAAuB,UAAUD,CAA4B,EAC7DI,EAAwB,QAAQD,CAA6B,EAC7DA,EAA8B,UAAU,OAAO,QAAQ,GAE3DN,EAAc,QAAO,EACrBF,EAAQ,UAAU,OAAO,QAAQ,EACjCC,EAAO,UAAU,IAAI,QAAQ,EAGpC,OAAQuB,EAAO,CACZ,QAAQ,IAAI,SAAUA,CAAK,CAC9B,CACL,CAEA,SAASC,GAAkB,CACvBxB,EAAO,UAAU,OAAO,QAAQ,EAChCD,EAAQ,UAAU,IAAI,QAAQ,EAC9BQ,EAA8B,UAAU,IAAI,QAAQ,EACpDQ,EAAO,EACPhB,EAAQ,UAAY,GACpB,MAAM0B,EAAQ,SAAS,cAAc,WAAW,EAC5CA,GACAb,EAAS,KAAK,CACV,cAAe,WAClB,EAAEa,CAAK,CAEhB,CAEA,eAAenB,GAAiB,CAC5BN,EAAO,UAAU,OAAO,QAAQ,EAChCe,IACA,MAAMI,EAAU,CACpB,CAEArB,EAAK,iBAAiB,SAAU,MAAO4B,GAAQ,CAC3CA,EAAI,eAAc,EAClBF,IACAV,EAAahB,EAAK,SAAS,WAAW,MAAM,KAAI,EAChD,MAAMqB,EAAU,EAChBrB,EAAK,MAAK,CACd,CAAC"}